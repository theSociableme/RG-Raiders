{"ast":null,"code":"import _regeneratorRuntime from \"/Users/mark.wagner/Dropbox/projects/TheGame/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/mark.wagner/Dropbox/projects/TheGame/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/mark.wagner/Dropbox/projects/TheGame/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"/Users/mark.wagner/Dropbox/projects/TheGame/packages/web/components/Setup/SetupUsername.tsx\",\n    _this = this,\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport { Input, MetaButton, MetaHeading, useToast } from '@raidguild/ds';\nimport { FlexContainer } from 'components/Container';\nimport { useSetupFlow } from 'contexts/SetupContext';\nimport { useUpdatePlayerUsernameMutation } from 'graphql/autogen/types';\nimport { useUser } from 'lib/hooks';\nimport React, { useState } from 'react';\nexport var SetupUsername = function SetupUsername(_ref) {\n  _s();\n\n  var username = _ref.username,\n      setUsername = _ref.setUsername;\n\n  var _useSetupFlow = useSetupFlow(),\n      onNextPress = _useSetupFlow.onNextPress,\n      nextButtonLabel = _useSetupFlow.nextButtonLabel;\n\n  var _useUser = useUser({\n    redirectTo: '/'\n  }),\n      user = _useUser.user;\n\n  var toast = useToast();\n\n  var _useUpdatePlayerUsern = useUpdatePlayerUsernameMutation(),\n      _useUpdatePlayerUsern2 = _slicedToArray(_useUpdatePlayerUsern, 2),\n      updateUsernameRes = _useUpdatePlayerUsern2[0],\n      updateUsername = _useUpdatePlayerUsern2[1];\n\n  var _useState = useState(false),\n      loading = _useState[0],\n      setLoading = _useState[1];\n\n  var handleNextPress = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var _yield$updateUsername, error, errorDetail;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (user) {\n                _context.next = 2;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 2:\n              setLoading(true);\n              _context.next = 5;\n              return updateUsername({\n                playerId: user.id,\n                username: username !== null && username !== void 0 ? username : ''\n              });\n\n            case 5:\n              _yield$updateUsername = _context.sent;\n              error = _yield$updateUsername.error;\n\n              if (!error) {\n                _context.next = 13;\n                break;\n              }\n\n              errorDetail = 'The octo is sad ðŸ˜¢';\n\n              if (error.message.includes('Uniqueness violation')) {\n                errorDetail = 'This username is already taken ðŸ˜¢';\n              } else if (error.message.includes('username_is_valid')) {\n                errorDetail = 'A username can only contain lowercase letters, numbers, and dashes.';\n              }\n\n              toast({\n                title: 'Error',\n                description: \"Unable to update Player Username. \".concat(errorDetail),\n                status: 'error',\n                isClosable: true\n              });\n              setLoading(false);\n              return _context.abrupt(\"return\");\n\n            case 13:\n              onNextPress();\n\n            case 14:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleNextPress() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(FlexContainer, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 55,\n      columnNumber: 5\n    }\n  }, __jsx(MetaHeading, {\n    mb: 10,\n    textAlign: \"center\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 56,\n      columnNumber: 7\n    }\n  }, \"What username would you like?\"), __jsx(Input, {\n    background: \"dark\",\n    placeholder: \"USERNAME\",\n    value: username,\n    onChange: function onChange(e) {\n      return setUsername(e.target.value);\n    },\n    w: \"auto\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 7\n    }\n  }), __jsx(MetaButton, {\n    onClick: handleNextPress,\n    mt: 10,\n    isLoading: updateUsernameRes.fetching || loading,\n    loadingText: \"Saving\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 7\n    }\n  }, nextButtonLabel));\n};\n\n_s(SetupUsername, \"QReiPrsADARU7gGUGDjhy1sLx7c=\", false, function () {\n  return [useSetupFlow, useUser, useToast, useUpdatePlayerUsernameMutation];\n});\n\n_c = SetupUsername;\n\nvar _c;\n\n$RefreshReg$(_c, \"SetupUsername\");","map":{"version":3,"sources":["/Users/mark.wagner/Dropbox/projects/TheGame/packages/web/components/Setup/SetupUsername.tsx"],"names":["Input","MetaButton","MetaHeading","useToast","FlexContainer","useSetupFlow","useUpdatePlayerUsernameMutation","useUser","React","useState","SetupUsername","username","setUsername","onNextPress","nextButtonLabel","redirectTo","user","toast","updateUsernameRes","updateUsername","loading","setLoading","handleNextPress","playerId","id","error","errorDetail","message","includes","title","description","status","isClosable","e","target","value","fetching"],"mappings":"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","sourcesContent":["import { Input, MetaButton, MetaHeading, useToast } from '@raidguild/ds';\nimport { FlexContainer } from 'components/Container';\nimport { useSetupFlow } from 'contexts/SetupContext';\nimport { useUpdatePlayerUsernameMutation } from 'graphql/autogen/types';\nimport { useUser } from 'lib/hooks';\nimport React, { useState } from 'react';\n\nexport type SetupUsernameProps = {\n  username: string | undefined;\n  setUsername: React.Dispatch<React.SetStateAction<string | undefined>>;\n};\n\nexport const SetupUsername: React.FC<SetupUsernameProps> = ({\n  username,\n  setUsername,\n}) => {\n  const { onNextPress, nextButtonLabel } = useSetupFlow();\n  const { user } = useUser({ redirectTo: '/' });\n  const toast = useToast();\n\n  const [updateUsernameRes, updateUsername] = useUpdatePlayerUsernameMutation();\n  const [loading, setLoading] = useState(false);\n\n  const handleNextPress = async () => {\n    if (!user) return;\n\n    setLoading(true);\n    const { error } = await updateUsername({\n      playerId: user.id,\n      username: username ?? '',\n    });\n\n    if (error) {\n      let errorDetail = 'The octo is sad ðŸ˜¢';\n      if (error.message.includes('Uniqueness violation')) {\n        errorDetail = 'This username is already taken ðŸ˜¢';\n      } else if (error.message.includes('username_is_valid')) {\n        errorDetail =\n          'A username can only contain lowercase letters, numbers, and dashes.';\n      }\n      toast({\n        title: 'Error',\n        description: `Unable to update Player Username. ${errorDetail}`,\n        status: 'error',\n        isClosable: true,\n      });\n      setLoading(false);\n      return;\n    }\n\n    onNextPress();\n  };\n\n  return (\n    <FlexContainer>\n      <MetaHeading mb={10} textAlign=\"center\">\n        What username would you like?\n      </MetaHeading>\n      <Input\n        background=\"dark\"\n        placeholder=\"USERNAME\"\n        value={username}\n        onChange={(e: React.ChangeEvent<HTMLInputElement>) =>\n          setUsername(e.target.value)\n        }\n        w=\"auto\"\n      />\n\n      <MetaButton\n        onClick={handleNextPress}\n        mt={10}\n        isLoading={updateUsernameRes.fetching || loading}\n        loadingText=\"Saving\"\n      >\n        {nextButtonLabel}\n      </MetaButton>\n    </FlexContainer>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"var _jsxFileName = \"/Users/mark.wagner/Dropbox/projects/TheGame/packages/web/pages/players.tsx\",\n    _this = this,\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport { LoadingState, Text, VStack } from '@metafam/ds';\nimport { PageContainer } from 'components/Container';\nimport { AdjascentTimezonePlayers } from 'components/Player/Filter/AdjascentTimezonePlayers';\nimport { PlayerFilter } from 'components/Player/Filter/PlayerFilter';\nimport { PlayersNotFound } from 'components/Player/Filter/PlayersNotFound';\nimport { PlayerList } from 'components/Player/PlayerList';\nimport { HeadComponent } from 'components/Seo';\nimport { usePlayerFilter } from 'lib/hooks/players';\nimport { useOnScreen } from 'lib/hooks/useOnScreen';\nimport React, { useEffect, useMemo, useRef } from 'react';\n\nvar Players = function Players() {\n  _s();\n\n  var _usePlayerFilter = usePlayerFilter(),\n      players = _usePlayerFilter.players,\n      aggregates = _usePlayerFilter.aggregates,\n      fetching = _usePlayerFilter.fetching,\n      fetchingMore = _usePlayerFilter.fetchingMore,\n      error = _usePlayerFilter.error,\n      queryVariables = _usePlayerFilter.queryVariables,\n      setQueryVariable = _usePlayerFilter.setQueryVariable,\n      resetFilter = _usePlayerFilter.resetFilter,\n      totalCount = _usePlayerFilter.totalCount,\n      nextPage = _usePlayerFilter.nextPage,\n      moreAvailable = _usePlayerFilter.moreAvailable;\n\n  var moreRef = useRef(null);\n  var onScreen = useOnScreen(moreRef);\n  useEffect(function () {\n    if (onScreen && !fetching && !fetchingMore && moreAvailable) {\n      nextPage();\n    }\n  }, [nextPage, onScreen, fetching, fetchingMore, moreAvailable]);\n  var isLoading = useMemo(function () {\n    return fetching || fetchingMore || moreAvailable;\n  }, [fetching, fetchingMore, moreAvailable]);\n  return __jsx(PageContainer, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 5\n    }\n  }, __jsx(HeadComponent, {\n    url: \"https://my.metagame.wtf/players\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 7\n    }\n  }), __jsx(VStack, {\n    w: \"100%\",\n    spacing: {\n      base: '4',\n      md: '8'\n    },\n    pb: {\n      base: '16',\n      lg: '0'\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 7\n    }\n  }, __jsx(PlayerFilter, {\n    fetching: fetching,\n    fetchingMore: fetchingMore,\n    aggregates: aggregates,\n    queryVariables: queryVariables,\n    setQueryVariable: setQueryVariable,\n    resetFilter: resetFilter,\n    totalCount: totalCount,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 9\n    }\n  }), error ? __jsx(Text, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 18\n    }\n  }, \"Error: \".concat(error.message)) : null, !error && players.length && (fetchingMore || !fetching) ? __jsx(PlayerList, {\n    players: players,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 11\n    }\n  }) : null, __jsx(MorePlayers, {\n    ref: moreRef,\n    fetching: isLoading,\n    totalCount: totalCount,\n    queryVariables: queryVariables,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 9\n    }\n  })));\n};\n\n_s(Players, \"nUGjjc6UAYPHZtryb/kuyJWNkQo=\", false, function () {\n  return [usePlayerFilter, useOnScreen];\n});\n\n_c = Players;\nexport var __N_SSG = true;\nexport default Players;\nvar MorePlayers = /*#__PURE__*/React.forwardRef(_c2 = _s2(function (_ref, ref) {\n  _s2();\n\n  var fetching = _ref.fetching,\n      totalCount = _ref.totalCount,\n      queryVariables = _ref.queryVariables;\n  var isTimezoneSelected = useMemo(function () {\n    return queryVariables.timezones && queryVariables.timezones.length > 0;\n  }, [queryVariables]);\n  return __jsx(VStack, {\n    w: \"100%\",\n    ref: ref,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 7\n    }\n  }, fetching ? __jsx(LoadingState, {\n    color: \"white\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 21\n    }\n  }) : null, !fetching && !isTimezoneSelected && totalCount > 0 ? __jsx(Text, {\n    color: \"white\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 11\n    }\n  }, \"No more players available.\") : null, !fetching && totalCount === 0 ? __jsx(PlayersNotFound, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 42\n    }\n  }) : null, !fetching && isTimezoneSelected ? __jsx(AdjascentTimezonePlayers, {\n    queryVariables: queryVariables,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 11\n    }\n  }) : null);\n}, \"AIbejXoUTm6VdpkOt4EZ+uWPUq8=\"));\n_c3 = MorePlayers;\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"Players\");\n$RefreshReg$(_c2, \"MorePlayers$React.forwardRef\");\n$RefreshReg$(_c3, \"MorePlayers\");","map":{"version":3,"sources":["/Users/mark.wagner/Dropbox/projects/TheGame/packages/web/pages/players.tsx"],"names":["LoadingState","Text","VStack","PageContainer","AdjascentTimezonePlayers","PlayerFilter","PlayersNotFound","PlayerList","HeadComponent","usePlayerFilter","useOnScreen","React","useEffect","useMemo","useRef","Players","players","aggregates","fetching","fetchingMore","error","queryVariables","setQueryVariable","resetFilter","totalCount","nextPage","moreAvailable","moreRef","onScreen","isLoading","base","md","lg","message","length","MorePlayers","forwardRef","ref","isTimezoneSelected","timezones"],"mappings":"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","sourcesContent":["import { LoadingState, Text, VStack } from '@metafam/ds';\nimport { PageContainer } from 'components/Container';\nimport { AdjascentTimezonePlayers } from 'components/Player/Filter/AdjascentTimezonePlayers';\nimport { PlayerFilter } from 'components/Player/Filter/PlayerFilter';\nimport { PlayersNotFound } from 'components/Player/Filter/PlayersNotFound';\nimport { PlayerList } from 'components/Player/PlayerList';\nimport { HeadComponent } from 'components/Seo';\nimport { GetPlayersQueryVariables } from 'graphql/autogen/types';\nimport { getSsrClient } from 'graphql/client';\nimport { getPlayerFilters, getPlayersWithCount } from 'graphql/getPlayers';\nimport { usePlayerFilter } from 'lib/hooks/players';\nimport { useOnScreen } from 'lib/hooks/useOnScreen';\nimport { InferGetStaticPropsType } from 'next';\nimport React, { useEffect, useMemo, useRef } from 'react';\n\ntype Props = InferGetStaticPropsType<typeof getStaticProps>;\n\nexport const getStaticProps = async () => {\n  const [ssrClient, ssrCache] = getSsrClient();\n\n  // This populates the cache server-side\n  const { error } = await getPlayersWithCount(undefined, ssrClient);\n  if (error) {\n    // eslint-disable-next-line no-console\n    console.error('getPlayers error', error);\n  }\n  await getPlayerFilters(ssrClient);\n\n  return {\n    props: {\n      urqlState: ssrCache.extractData(),\n    },\n    revalidate: 1,\n  };\n};\n\nconst Players: React.FC<Props> = () => {\n  const {\n    players,\n    aggregates,\n    fetching,\n    fetchingMore,\n    error,\n    queryVariables,\n    setQueryVariable,\n    resetFilter,\n    totalCount,\n    nextPage,\n    moreAvailable,\n  } = usePlayerFilter();\n\n  const moreRef = useRef<HTMLDivElement>(null);\n\n  const onScreen = useOnScreen(moreRef);\n\n  useEffect(() => {\n    if (onScreen && !fetching && !fetchingMore && moreAvailable) {\n      nextPage();\n    }\n  }, [nextPage, onScreen, fetching, fetchingMore, moreAvailable]);\n\n  const isLoading = useMemo(() => fetching || fetchingMore || moreAvailable, [\n    fetching,\n    fetchingMore,\n    moreAvailable,\n  ]);\n\n  return (\n    <PageContainer>\n      <HeadComponent url=\"https://my.metagame.wtf/players\" />\n      <VStack\n        w=\"100%\"\n        spacing={{ base: '4', md: '8' }}\n        pb={{ base: '16', lg: '0' }}\n      >\n        <PlayerFilter\n          fetching={fetching}\n          fetchingMore={fetchingMore}\n          aggregates={aggregates}\n          queryVariables={queryVariables}\n          setQueryVariable={setQueryVariable}\n          resetFilter={resetFilter}\n          totalCount={totalCount}\n        />\n        {error ? <Text>{`Error: ${error.message}`}</Text> : null}\n        {!error && players.length && (fetchingMore || !fetching) ? (\n          <PlayerList players={players} />\n        ) : null}\n        <MorePlayers\n          ref={moreRef}\n          fetching={isLoading}\n          totalCount={totalCount}\n          queryVariables={queryVariables}\n        />\n      </VStack>\n    </PageContainer>\n  );\n};\n\nexport default Players;\n\ntype MorePlayersProps = {\n  fetching: boolean;\n  totalCount: number;\n  queryVariables: GetPlayersQueryVariables;\n};\n\nconst MorePlayers = React.forwardRef<HTMLDivElement, MorePlayersProps>(\n  ({ fetching, totalCount, queryVariables }, ref) => {\n    const isTimezoneSelected = useMemo(\n      () => queryVariables.timezones && queryVariables.timezones.length > 0,\n      [queryVariables],\n    );\n\n    return (\n      <VStack w=\"100%\" ref={ref}>\n        {fetching ? <LoadingState color=\"white\" /> : null}\n        {!fetching && !isTimezoneSelected && totalCount > 0 ? (\n          <Text color=\"white\">No more players available.</Text>\n        ) : null}\n        {!fetching && totalCount === 0 ? <PlayersNotFound /> : null}\n        {!fetching && isTimezoneSelected ? (\n          <AdjascentTimezonePlayers queryVariables={queryVariables} />\n        ) : null}\n      </VStack>\n    );\n  },\n);\n"]},"metadata":{},"sourceType":"module"}